<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Frontend API Integration Test</h1>
    
    <div class="section">
        <h2>1. Load Customers</h2>
        <button onclick="loadCustomers()">Load Customers</button>
        <div id="loadResult"></div>
    </div>
    
    <div class="section">
        <h2>2. Add New Customer</h2>
        <button onclick="addCustomer()">Add Test Customer</button>
        <div id="addResult"></div>
    </div>
    
    <div class="section">
        <h2>3. Delete Customer</h2>
        <input type="number" id="deleteId" placeholder="Customer ID to delete" value="3">
        <button onclick="deleteCustomer()">Delete Customer</button>
        <div id="deleteResult"></div>
    </div>

    <script>
        async function loadCustomers() {
            const resultDiv = document.getElementById('loadResult');
            try {
                const response = await fetch('/customers');
                const customers = await response.json();
                resultDiv.innerHTML = `
                    <p class="success">✅ Loaded ${customers.length} customers</p>
                    <pre>${JSON.stringify(customers.filter(c => c.name), null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
            }
        }

        async function addCustomer() {
            const resultDiv = document.getElementById('addResult');
            const testCustomer = {
                name: 'テスト会社 ' + new Date().toLocaleTimeString(),
                plan: 'professional',
                mrr: 35000,
                initialFee: 150000,
                operationFee: 25000,
                assignee: '鈴木一郎',
                hours: 20,
                region: '関西',
                industry: '製造業',
                channel: '紹介',
                status: 'trial',
                startDate: new Date().toLocaleDateString('ja-JP').replace(/-/g, '/')
            };

            try {
                const response = await fetch('/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testCustomer)
                });
                const result = await response.json();
                resultDiv.innerHTML = `
                    <p class="success">✅ Customer added with ID: ${result.id}</p>
                    <pre>${JSON.stringify(testCustomer, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
            }
        }

        async function deleteCustomer() {
            const resultDiv = document.getElementById('deleteResult');
            const customerId = document.getElementById('deleteId').value;
            
            try {
                const response = await fetch(`/customers/${customerId}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (response.ok) {
                    resultDiv.innerHTML = `<p class="success">✅ Customer ${customerId} deleted successfully</p>`;
                } else {
                    resultDiv.innerHTML = `<p class="error">❌ Error: ${result.error}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
            }
        }

        // Load customers on page load
        window.addEventListener('DOMContentLoaded', loadCustomers);
    </script>
</body>
</html>